<body>
  <h1>ยินดีต้อนรับสู่เว็บไซต์ของเรา</h1>
  <p>หากมีคำถามสามารถพูดคุยกับเราผ่านระบบแชทที่มุมขวาล่าง</p>

  <!-- Tawk.to script -->
  <script type="text/javascript">
    var Tawk_API = Tawk_API || {}, Tawk_LoadStart = new Date();
    (function () {
      var s1 = document.createElement("script"), s0 = document.getElementsByTagName("script")[0];
      s1.async = true;
      s1.src = 'https://embed.tawk.to/68182cc5138f991917bc6a58/1iqf6tpdd';
      s1.charset = 'UTF-8';
      s1.setAttribute('crossorigin', '*');
      s0.parentNode.insertBefore(s1, s0);
    })();
  </script>

  <!-- AI Reply Script -->
  <script>
    Tawk_API = Tawk_API || {};
    Tawk_API.onLoad = function () {
      const observer = new MutationObserver(function (mutations) {
        mutations.forEach(function (mutation) {
          mutation.addedNodes.forEach(function (node) {
            if (node.nodeType === 1 && node.classList.contains("tawk-message") && node.classList.contains("tawk-message-visitor")) {
              const textEl = node.querySelector(".tawk-message-text");
              if (textEl) {
                const text = textEl.innerText.toLowerCase();
                if (text.includes("หมอ") || text.includes("แพทย์") || text.includes("เวร") || text.includes("ตรวจ")) {
                  fetch("https://script.google.com/macros/s/AKfycby4DtgL_j0VjvAAzlNt_8in5irfKytdQ7VUEjISGZpbpPEwAilW8Fg4X1QFOzs-TRHF/exec", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ question: text })
                  })
                    .then(res => res.json())
                    .then(data => {
                      if (data.answer) {
                        Tawk_API.sendMessage(data.answer);
                      } else {
                        Tawk_API.sendMessage("ขออภัย ไม่พบข้อมูลในระบบครับ");
                      }
                    })
                    .catch(err => {
                      Tawk_API.sendMessage("เกิดข้อผิดพลาดในการเชื่อมต่อกับระบบข้อมูล");
                    });
                }
              }
            }
          });
        });
      });

      const chatContainer = document.querySelector("body");
      observer.observe(chatContainer, { childList: true, subtree: true });
    };
  </script>
</body>
